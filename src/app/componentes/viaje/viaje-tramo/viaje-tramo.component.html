<form [formGroup]="formularioViajePropioTramo">
    <div class="row">
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoFecha" class="tamanio-label">Fecha</label>
                <input id="idTramoFecha" type="date" formControlName="fechaTramo" autocomplete="off"
                    class="form-control form-control-sm" [readonly]="soloLectura">
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group has-float-label">
                <label for="idTramo" class="tamanio-label">Tramo *</label>
                <input id="idTramo" class="form-control form-control-sm" type="text" matInput
                    [formControl]="formularioViajePropioTramo.get('tramo')" [matAutocomplete]="autoTramo"
                    autocomplete="off" [readonly]="soloLectura" placeholder="Buscar por Ciudad Origen"
                    (blur)="verificarSeleccion(formularioViajePropioTramo.get('tramo'))">
                <mat-autocomplete #autoTramo="matAutocomplete" [displayWith]="displayFn.bind(this)"
                    (optionSelected)="establecerKm()">
                    <mat-option *ngFor="let itemTramo of resultadosTramos" [value]="itemTramo">
                        {{itemTramo.origen.nombre}},
                        {{itemTramo.origen.provincia.nombre}} ->
                        {{itemTramo.destino.nombre}},
                        {{itemTramo.destino.provincia.nombre}}
                    </mat-option>
                </mat-autocomplete>
            </div>
        </div>
        <div class="col-md-1">
            <div class="form-group has-float-label">
                <label for="idKm" class="tamanio-label">Km</label>
                <input id="idKm" [textMask]="mascararKm(6)" type="text" formControlName="km" autocomplete="off"
                    class="form-control form-control-sm number-right" [readonly]="true" placeholder="0 km">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoEmpresa" class="tamanio-label">Empresa *</label>
                <mat-select id="idTramoEmpresa" class="form-control form-control-sm" formControlName="empresa"
                    [compareWith]="compareFn">
                    <mat-option *ngFor="let itemEmpresa of empresas" [value]="itemEmpresa">
                        {{itemEmpresa.razonSocial}}
                    </mat-option>
                </mat-select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoUnidadNegocio" class="tamanio-label">Unidad de Negocio *</label>
                <mat-select id="idTramoUnidadNegocio" class="form-control form-control-sm"
                    formControlName="viajeUnidadNegocio" [compareWith]="compareFn">
                    <mat-option *ngFor="let itemUnidadNegocio of unidadesNegocios" [value]="itemUnidadNegocio">
                        {{itemUnidadNegocio.nombre}}
                    </mat-option>
                </mat-select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoTipoViaje" class="tamanio-label">Modalidad de Carga *</label>
                <mat-select id="idTramoTipoViaje" class="form-control form-control-sm" formControlName="viajeTipo"
                    [compareWith]="compareFn" (selectionChange)="establecerEstadoTipoCarga()">
                    <mat-option *ngFor="let itemViajeTipo of viajesTipos" [value]="itemViajeTipo">
                        {{itemViajeTipo.nombre}}
                    </mat-option>
                </mat-select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoViajeTipoCarga" class="tamanio-label">Tipo de Carga *</label>
                <mat-select id="idTramoViajeTipoCarga" class="form-control form-control-sm"
                    formControlName="viajeTipoCarga" [compareWith]="compareFn">
                    <mat-option *ngFor="let itemViajeTipoCarga of viajesTiposCargas" [value]="itemViajeTipoCarga">
                        {{itemViajeTipoCarga.nombre}}
                    </mat-option>
                </mat-select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoViajeTarifa" class="tamanio-label">Tarifa *</label>
                <mat-select id="idTramoViajeTarifa" class="form-control form-control-sm" formControlName="viajeTarifa"
                    [compareWith]="compareFn" (optionSelected)="establecerTipoViaje(tipoViaje)">
                    <mat-option *ngFor="let itemViajeTarifa of viajesTarifas" [value]="itemViajeTarifa">
                        {{itemViajeTarifa.nombre}}
                    </mat-option>
                </mat-select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
            <div class="form-group has-float-label">
                <label for="idTramoCantidad" class="tamanio-label">Cantidad *</label>
                <input id="idTramoCantidad" [textMask]="mascararEnteros(4)" type="text" formControlName="cantidad"
                    autocomplete="off" class="form-control form-control-sm number-right"
                    [readonly]="soloLectura || estadoTarifa()"
                    (blur)="calcularImporte(formularioViajePropioTramo, null, null)" placeholder="0">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoPrecioUnitario" class="tamanio-label">Precio Unitario *</label>
                <input id="idTramoPrecioUnitario" [textMask]="mascararImporte(8, 3)" type="text"
                    formControlName="precioUnitario" autocomplete="off"
                    class="form-control form-control-sm number-right" [readonly]="soloLectura || estadoTarifa()"
                    placeholder="$ 0.000"
                    (blur)="calcularImporte(formularioViajePropioTramo, formularioViajePropioTramo.get('precioUnitario'), 3)">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group has-float-label">
                <label for="idTramoImporte" class="tamanio-label">Importe *</label>
                <input id="idTramoImporte" [textMask]="mascararImporte(8)" type="text" formControlName="importe"
                    autocomplete="off" class="form-control form-control-sm number-right" [readonly]="soloLectura"
                    placeholder="$ 0.00">
            </div>
        </div>
        <div class="col-md-4">
            <div class="inline">
                <button mat-raised-button (click)="verDadorDestinatarioDialogo()"
                    [disabled]="soloLectura">Dador-Destinatario</button>
                <button mat-raised-button (click)="abrirObservacionesDialogo()">Observaciones</button>
                <button mat-raised-button color="primary" (click)="agregarTramo()"
                    [disabled]="!formularioViajePropioTramo.valid" *ngIf="btnTramo">Agregar Tramo</button>
                <button mat-raised-button color="primary" (click)="modificarTramo()"
                    [disabled]="!formularioViajePropioTramo.valid" *ngIf="!btnTramo">Actualizar Tramo</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" style="height: 250px; overflow-y: scroll;">
            <table class="table table-bordered table-striped table-sm table-condensed tabla-viaje">
                <thead>
                    <tr>
                        <th class="text-center" style="width:2%" scope="col">#</th>
                        <th class="text-center" style="width:5%" scope="col">Fecha</th>
                        <th class="text-center" style="width:18%" scope="col">Tramo</th>
                        <th class="text-center" style="width:3%" scope="col">Km</th>
                        <th class="text-center" style="width:15%" scope="col">Empresa</th>
                        <th class="text-center" style="width:5%" scope="col">Tipo Carga</th>
                        <th class="text-center" style="width:10%" scope="col">Tipo Viaje</th>
                        <th class="text-center" style="width:8%" scope="col">Tarifa</th>
                        <th class="text-center" style="width:10%" scope="col">Dador-Destinatario</th>
                        <th class="text-center" style="width:10%" scope="col">Unidad Negocio</th>
                        <th class="text-center" style="width:5%" scope="col">Obs.</th>
                        <th class="text-center" style="width:4%" scope="col" *ngIf="!soloLectura">-</th>
                        <th class="text-center" style="width:2%" scope="col" *ngIf="!soloLectura">-</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let l of listaTramos; let i = index">
                        <td align="center">
                            <span>{{l.numeroOrden}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.fechaTramo| date: 'dd/MM/yyyy'}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.tramo.origen.nombre}} ->
                                {{l.tramo.destino.nombre}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.tramo.km}} km</span>
                        </td>
                        <td align="center">
                            <span>{{l.empresa.razonSocial}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.viajeTipoCarga.nombre}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.viajeTipo.nombre}}</span>
                        </td>
                        <td align="center">
                            <span>{{l.viajeTarifa.nombre}}</span>
                        </td>
                        <td align="center">
                            <span class="cursor-color" (click)="verDadorDestTablaDialogo(l)">ver</span>
                        </td>
                        <td align="center">
                            <span>{{l.viajeUnidadNegocio.nombre}}</span>
                        </td>
                        <td align="center">
                            <span class="cursor-color" (click)="verObservacionesDialogo(l.observaciones)">ver</span>
                        </td>
                        <td align="center" *ngIf="!soloLectura">
                            <span class="cursor-color" (click)="modTramo(i)">editar</span>
                        </td>
                        <td align="center" *ngIf="!soloLectura">
                            <span class="cursor-color-rojo" (click)="eliminarTramo(i, l)">X</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</form>